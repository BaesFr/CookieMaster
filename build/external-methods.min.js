var CME={},CMEO={};CME.cacheStore={},CME.informations={items:[],bonus:[],bci:[],roi:[],timeLeft:[]},CME.milkPotentials={"Kitten helpers":.05,"Kitten workers":.1,"Kitten engineers":.2,"Kitten overseers":.2,"Santa's milk and cookies":.05},CME.getAchievementWorth=function(a,b,c,d){var e,f,g,h=0,i=0,j=this.getHeavenlyMultiplier(),k=Game.milkProgress;return"undefined"==typeof d&&(d=0),0!==d&&(j=d),Game.UpgradesById.forEach(function(a){a.bought&&a.matches("Cookie production multiplier <b>+")&&(j+=a.getDescribedInteger()),a.id===b&&a&&!a.bought&&a.matches("Cookie production multiplier <b>+")&&(i+=a.getDescribedInteger())}),e=this.applyMilkPotential(j,k),f=this.computeNewIncome(c,e),g=Game.UpgradesById[b].name,j+=i,k+=.04*a,e=this.applyMilkPotential(j,k,g),h=this.computeNewIncome(c,e),a=this.getUnlockedIncomeAchievements(h),a>0&&(k+=.04*a,e=this.applyMilkPotential(j,k,g),h=this.computeNewIncome(c,e)),0===d&&(h-=f),Game.Has("Elder Covenant")&&(h*=.95),h},CME.computeNewIncome=function(a,b){return(Game.cookiesPs+a)/Game.globalCpsMult*(b/100)*this.getFrenzyMultiplier()},CME.getUnlockedIncomeAchievements=function(a){var b=0;return Game.frenzyPower?0:(Game.AchievementsById.forEach(function(c){!c.won&&c.matches(" per second.")&&a>=c.getDescribedInteger()&&b++}),b)},CME.applyMilkPotential=function(a,b,c){var d,e,f=[];"undefined"==typeof b&&(b=Game.milkProgress);for(d in this.milkPotentials)e=Game.Has(d)||d===c,f.push(e*this.milkPotentials[d]);return a+=100,f.forEach(function(c){a*=1+c*b}),a},CME.hasAchievement=function(a){var b=Game.Achievements[a];return b?b.won:!1},CME.hasntAchievement=function(a){return!this.hasAchievement(a)},CME.getBestValue=function(a){return[Math[a].apply(Math,this.informations.bci),Math[a].apply(Math,this.informations.timeLeft),Math[a].apply(Math,this.informations.roi)]},CME.setBuildingInformations=function(a,b){this.informations.items[a]=b.items,this.informations.bonus[a]=b.bonus,this.informations.bci[a]=b.bci,this.informations.roi[a]=b.roi,this.informations.timeLeft[a]=b.timeLeft},CME.updateBuildingsInformations=function(){Game.ObjectsById.forEach(function(a,b){var c='(<span class="text-blue">'+a.amount+"</span>)";CME.setBuildingInformations(b,{items:a.name.split(" ")[0]+" "+c,bonus:a.getWorth(!0),bci:a.getBaseCostPerIncome(!0),roi:a.getReturnInvestment(),timeLeft:a.getTimeLeft()})})},CME.getBuildingWorth=function(a){return this.simulateBuy(a,"cookiesPs")},CME.getFrenzyMultiplier=function(){return Game.frenzy>0?Game.frenzyPower:1},CME.getLuckyTreshold=function(a,b){var c=b||Game.cookiesPs;return c/=this.getFrenzyMultiplier(),"frenzy"===a&&(c*=7),Math.round(10*(60*c*20+13))},CME.getHeavenlyMultiplier=function(){var a,b=2*Game.prestige["Heavenly chips"],c=0,d={"Heavenly chip secret":.05,"Heavenly cookie stand":.2,"Heavenly bakery":.25,"Heavenly confectionery":.25,"Heavenly key":.25};for(a in d)Game.Has(a)&&(c+=d[a]);return b*c},CME.getUpgradeWorth=function(a){var b,c=0,d=0,e=Game.globalCpsMult,f=["Cursors","Grandmas","Farms","Factories","Mines","Shipments","Alchemy labs","Portals","Time machines","Antimatter condensers","Prisms"];return f.forEach(function(b,d){a.matches(b+" are <b>")&&(c=CME.getBuildingUpgradeOutcome(d))}),b=[{building:"Cursors",modifier:.1},{building:"Grandmas",modifier:.3},{building:"Farms",modifier:.5},{building:"Factories",modifier:4},{building:"Mines",modifier:10},{building:"Shipments",modifier:30},{building:"Alchemy labs",modifier:100},{building:"Portals",modifier:1666},{building:"Time machines",modifier:9876},{building:"Antimatter condensers",modifier:99999},{building:"Prisms",modifier:1e6}],b.forEach(function(b,d){a.matches(b.building+" gain <b>")&&(c=CME.getMultiplierOutcome(b.building,b.modifier,d))}),a.matches("Grandmas are <b>twice</b>")?d+=this.lgt(a):a.matches("for each non-cursor object")?c=this.getNonObjectsGainOutcome(a):a.matches("for every 50 grandmas")?c=this.getGrandmasPerGrandmaOutcome():a.matches("for every 20 portals")?c=this.getGrandmasPerPortalOutcome():a.matches("potential of your heavenly")&&(c=this.getHeavenlyUpgradeOutcome(d,a)/e,"Heavenly key"===a.name&&(d+=this.hasntAchievement("Wholesome"))),"Elder Covenant"===a.name?Game.cookiesPs*-.05:"Revoke Elder Covenant"===a.name?Game.cookiesPs/e*1.05*e-Game.cookiesPs:(19===Game.UpgradesOwned&&(d+=this.hasntAchievement("Enhancer")),49===Game.UpgradesOwned&&(d+=this.hasntAchievement("Augmenter")),99===Game.UpgradesOwned&&(d+=this.hasntAchievement("Upgrader")),c*e+this.callCached("getAchievementWorth",[d,a.id,c]))},CME.getBuildingUpgradeOutcome=function(a){return Game.ObjectsById[a].storedTotalCps},CME.getMultiplierOutcome=function(a,b,c){var d=1;return Game.UpgradesById.forEach(function(b){b.bought&&b.matches(a+" are <b>twice</b>")&&(d=2*d),b.bought&&b.matches(a+" are <b>4 times</b>")&&(d=4*d)}),Game.ObjectsById[c].amount*d*b},CME.getHeavenlyUpgradeOutcome=function(a,b){var c=2*Game.prestige["Heavenly chips"]*(b.getDescribedInteger()/100);return this.callCached("getAchievementWorth",[a,b.id,0,c])-Game.cookiesPs},CME.getGrandmasPerPortalOutcome=function(){var a=1;return Game.UpgradesById.forEach(function(b){b.bought&&b.matches("Grandmas are <b>twice</b>.")&&(a=2*a),b.bought&&b.matches("Grandmas are <b>4 times</b>")&&(a=4*a)}),.05*Game.ObjectsById[7].amount*a*Game.ObjectsById[1].amount},CME.getGrandmasPerGrandmaOutcome=function(){var a=1;return Game.UpgradesById.forEach(function(b){b.bought&&b.matches("Grandmas are <b>twice</b>")&&(a=2*a),b.bought&&b.matches("Grandmas are <b>4 times</b>")&&(a=4*a)}),.02*Game.ObjectsById[1].amount*a*Game.ObjectsById[1].amount},CME.lgt=function(a){var b=[];return this.hasAchievement("Elder Pact")||-1===a.name.indexOf(" grandmas")?!1:(Game.UpgradesById.forEach(function(a,c){a.bought||-1===a.name.indexOf(" grandmas ")||b.push(c)}),1===b.length&&b[0]===a.id)},CME.getNonObjectsGainOutcome=function(a){return a.getDescribedInteger()*(Game.BuildingsOwned-Game.ObjectsById[0].amount)*Game.ObjectsById[0].amount},CME.getFourTimesEfficientOutcome=function(a){return 3*Game.ObjectsById[a].storedTotalCps},CME.cache=function(a,b,c){var d,e=[Game.UpgradesOwned,Game.BuildingsOwned,Game.globalCpsMult].join("-");return"undefined"==typeof this.cacheStore[e]&&(this.refreshCache(),this.cacheStore[e]={}),c=c||[],a=this.computeSalts(a,c),"undefined"!=typeof this.cacheStore[e][a]?this.cacheStore[e][a]:(d=b.apply(this,c),this.cacheStore[e][a]=d,d)},CME.callCached=function(a,b,c){return c=c||[],c.push(a),this.cache(c,this[a],b)},CME.refreshCache=function(){this.cacheStore={}},CME.computeSalts=function(a,b){a=a.concat(b);for(var c=0;c<a.length;c++)"undefined"!=typeof a[c].identifier&&(a[c]=a[c].identifier());return a.join("-")},CME.roundDecimal=function(a){return Math.round(100*a)/100},CME.secondsLeft=function(a){var b=Game.cookies-a.getPrice();return 0===Game.cookiesPs||b>0?0:Math.round(Math.abs(b)/CM.effectiveCps())},CME.getTimeToCookies=function(a){return CM.formatTime(a/CM.effectiveCps(),!0)},CMEO.identifier=function(){return"cookie-master__"+this.getType()+"--"+this.id},CMEO.matches=function(a){return this.desc?-1!==this.desc.toLowerCase().indexOf(a.toLowerCase()):!1},CMEO.getDescribedInteger=function(){return this.matches("<b>")?1*this.desc.match(/<b>\+?([\.0-9]+)%?/)[1].replace(/[%,]/g,""):void 0},CMEO.getTypeOf=function(){return this instanceof Game.Upgrade?"upgrade":"object"},CMEO.getWorthOf=function(a){var b="upgrade"===this.getType()?CME.callCached("getUpgradeWorth",[this]):CME.callCached("getBuildingWorth",[this]);return a?CME.roundDecimal(b):b},CMEO.getBaseCostPerIncome=function(a){var b=this.getWorth(),c=CME.roundDecimal(this.getPrice()/b);return 0>b?1/0:a?CME.roundDecimal(c):c},CMEO.getReturnInvestment=function(){var a=this.getWorth();return this.price*(a+Game.cookiesPs)/a},CMEO.getTimeLeft=function(){return CME.secondsLeft(this)},CMEO.getComparativeInfos=function(){return[this.getBaseCostPerIncome(),this.getTimeLeft(),this.getReturnInvestment()]},CMEO.getColors=function(){return CME.computeColorCoding(this.getComparativeInfos())},CME.getThresholdAlerts=function(a){var b=a.getPrice(),c=Game.cookiesPs+a.getWorth(),d=[0,0,0],e=[this.getLuckyTreshold(!1,c),this.getLuckyTreshold("frenzy",c),CM.requiredChainTier("bank","this",CM.maxChainReward())];return Game.cookies-b<e[0]&&(d[0]=e[0]-(Game.cookies-b)),Game.cookies-b<e[1]&&(d[1]=e[1]-(Game.cookies-b)),Game.cookies-b<e[2]&&(d[2]=e[2]-(Game.cookies-b)),d},CME.computeColorCoding=function(a){var b,c=["yellow","yellow","yellow"],d=this.getBestValue("max"),e=this.getBestValue("min");for(b=0;b<a.length;b++)1/0===a[b]?c[b]="greyLight":a[b]<e[b]?c[b]="blue":a[b]===e[b]?c[b]="green":a[b]===d[b]?c[b]="red":a[b]>d[b]?c[b]="purple":d[b]-a[b]<a[b]-e[b]&&(c[b]="orange");return a[2]===e[2]&&(c[2]="cyan"),c},CMEO.isInStore=function(){return-1!==Game.UpgradesInStore.indexOf(this)},CME.simulateBuy=function(a,b){var c,d={SetResearch:Game.SetResearch,Popup:Game.Popup,Win:Game.Win,Unlock:Game.Unlock},e={cpsSucked:Game.cpsSucked,globalCpsMult:Game.globalCpsMult,cookiesPs:Game.cookiesPs,computedMouseCps:Game.computedMouseCps};return Game.SetResearch=function(){},Game.Popup=function(){},Game.Win=function(){},Game.Unlock=function(){},a.simulateToggle(!0),Game.CalculateGains(),c=Game[b],a.simulateToggle(!1),Game.cpsSucked=e.cpsSucked,Game.globalCpsMult=e.globalCpsMult,Game.cookiesPs=e.cookiesPs,Game.computedMouseCps=e.computedMouseCps,Game.SetResearch=d.SetResearch,Game.Popup=d.Popup,Game.Win=d.Win,Game.Unlock=d.Unlock,c-Game[b]},CMEO.simulateBuildingToggle=function(a){a?(this.amount++,this.bought++,this.buyFunction&&this.buyFunction()):(this.amount--,this.bought--,this.sellFunction&&this.sellFunction())},CMEO.simulateUpgradeToggle=function(a){a?(this.bought=1,this.buyFunction&&this.buyFunction(),3!==this.hide&&Game.UpgradesOwned++):(this.bought=0,3!==this.hide&&Game.UpgradesOwned--)},CMEO.isClickingRelated=function(){return this.matches("Clicking")||this.matches("The mouse")},CMEO.getClickingWorth=function(){return CME.callCached("getClickingUpgradeWorth",[this])},CME.getClickingUpgradeWorth=function(a){return this.simulateBuy(a,"computedMouseCps")},CME.controlTooltipPosition=function(){var a=Game.mouseY,b=CM.config.ccTooltip,c=CM.config.ccTooltipAnchor;this.tooltipLastObjectId&&(a=$(window).height()-b.outerHeight(),a-=40,a=-40>a?-40:a,a=Game.mouseY<a?Game.mouseY:a),c.offset({top:a,left:Game.mouseX})};