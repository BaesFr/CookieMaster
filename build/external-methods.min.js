var CME={},CMEO={};CME.cacheStore={},CME.informations={items:[],bonus:[],bci:[],roi:[],timeLeft:[]},CME.milkPotentials={"Kitten helpers":.05,"Kitten workers":.1,"Kitten engineers":.2,"Kitten overseers":.2,"Santa's milk and cookies":.05},CME.getAchievementWorth=function(a,b,c,d){var e,f,g,h=0,i=0,j=this.getHeavenlyMultiplier(),k=Game.milkProgress;return"undefined"==typeof d&&(d=0),0!==d&&(j=d),Game.UpgradesById.forEach(function(a){a.bought&&a.matches("Cookie production multiplier <b>+")&&(j+=a.getDescribedInteger()),a.id===b&&a&&!a.bought&&a.matches("Cookie production multiplier <b>+")&&(i+=a.getDescribedInteger())}),e=this.applyMilkPotential(j,k),f=this.computeNewIncome(c,e),g=Game.UpgradesById[b].name,j+=i,k+=.04*a,e=this.applyMilkPotential(j,k,g),h=this.computeNewIncome(c,e),a=this.getUnlockedIncomeAchievements(h),a>0&&(k+=.04*a,e=this.applyMilkPotential(j,k,g),h=this.computeNewIncome(c,e)),0===d&&(h-=f),Game.Has("Elder Covenant")&&(h*=.95),h},CME.computeNewIncome=function(a,b){return(Game.cookiesPs+a)/Game.globalCpsMult*(b/100)*this.getFrenzyMultiplier()},CME.getUnlockedIncomeAchievements=function(a){var b=0;return Game.frenzyPower?0:(Game.AchievementsById.forEach(function(c){!c.won&&c.matches(" per second.")&&a>=c.getDescribedInteger()&&b++}),b)},CME.applyMilkPotential=function(a,b,c){var d,e,f=[];"undefined"==typeof b&&(b=Game.milkProgress);for(d in this.milkPotentials)e=Game.Has(d)||d===c,f.push(e*this.milkPotentials[d]);return a+=100,f.forEach(function(c){a*=1+c*b}),a},CME.getBestValue=function(a){return[Math[a].apply(Math,this.informations.bci),Math[a].apply(Math,this.informations.timeLeft),Math[a].apply(Math,this.informations.roi)]},CME.setBuildingInformations=function(a,b){this.informations.items[a]=b.items,this.informations.bonus[a]=b.bonus,this.informations.bci[a]=b.bci,this.informations.roi[a]=b.roi,this.informations.timeLeft[a]=b.timeLeft},CME.updateBuildingsInformations=function(){Game.ObjectsById.forEach(function(a,b){var c='(<span class="text-blue">'+a.amount+"</span>)";CME.setBuildingInformations(b,{items:a.name.split(" ")[0]+" "+c,bonus:a.getWorth(!0),bci:a.getBaseCostPerIncome(!0),roi:a.getReturnInvestment(),timeLeft:a.getTimeLeft()})})},CME.getBuildingWorth=function(a){return this.simulateBuy(a,"cookiesPs")},CME.getUpgradeWorth=function(a){return this.simulateBuy(a,"cookiesPs")},CME.getFrenzyMultiplier=function(){return Game.frenzy>0?Game.frenzyPower:1},CME.getLuckyTreshold=function(a,b){var c=b||Game.cookiesPs;return c/=this.getFrenzyMultiplier(),"frenzy"===a&&(c*=7),Math.round(10*(60*c*20+13))},CME.getHeavenlyMultiplier=function(){var a,b=2*Game.prestige["Heavenly chips"],c=0,d={"Heavenly chip secret":.05,"Heavenly cookie stand":.2,"Heavenly bakery":.25,"Heavenly confectionery":.25,"Heavenly key":.25};for(a in d)Game.Has(a)&&(c+=d[a]);return b*c},CME.cache=function(a,b,c){var d,e=[Game.UpgradesOwned,Game.BuildingsOwned,Game.globalCpsMult].join("-");return"undefined"==typeof this.cacheStore[e]&&(this.refreshCache(),this.cacheStore[e]={}),c=c||[],a=this.computeSalts(a,c),"undefined"!=typeof this.cacheStore[e][a]?this.cacheStore[e][a]:(d=b.apply(this,c),this.cacheStore[e][a]=d,d)},CME.callCached=function(a,b,c){return c=c||[],c.push(a),this.cache(c,this[a],b)},CME.refreshCache=function(){this.cacheStore={}},CME.computeSalts=function(a,b){a=a.concat(b);for(var c=0;c<a.length;c++)"undefined"!=typeof a[c].identifier&&(a[c]=a[c].identifier());return a.join("-")},CME.roundDecimal=function(a){return Math.round(100*a)/100},CME.secondsLeft=function(a){var b=Game.cookies-a.getPrice();return 0===Game.cookiesPs||b>0?0:Math.round(Math.abs(b)/CM.effectiveCps())},CME.getTimeToCookies=function(a){return CM.formatTime(a/CM.effectiveCps(),!0)},CMEO.identifier=function(){return"cookie-master__"+this.getType()+"--"+this.id},CMEO.matches=function(a){return this.desc?-1!==this.desc.toLowerCase().indexOf(a.toLowerCase()):!1},CMEO.getDescribedInteger=function(){return this.matches("<b>")?1*this.desc.match(/<b>\+?([\.0-9]+)%?/)[1].replace(/[%,]/g,""):void 0},CMEO.getTypeOf=function(){return this instanceof Game.Upgrade?"upgrade":"object"},CMEO.getWorthOf=function(a){var b="upgrade"===this.getType()?CME.callCached("getUpgradeWorth",[this]):CME.callCached("getBuildingWorth",[this]);return a?CME.roundDecimal(b):b},CMEO.getBaseCostPerIncome=function(a){var b,c=this.getWorth();return"upgrade"===this.getType()&&this.isClickingRelated()&&(c+=this.getClickingWorth()*CM.clickTracker.clicksPs),b=CME.roundDecimal(this.getPrice()/c),0>c?1/0:a?CME.roundDecimal(b):b},CMEO.getReturnInvestment=function(){var a=this.getWorth();return this.price*(a+Game.cookiesPs)/a},CMEO.getTimeLeft=function(){return CME.secondsLeft(this)},CMEO.getComparativeInfos=function(){return[this.getBaseCostPerIncome(),this.getTimeLeft(),this.getReturnInvestment()]},CMEO.getColors=function(){return CME.computeColorCoding(this.getComparativeInfos())},CME.getThresholdAlerts=function(a){var b=a.getPrice(),c=(Game.cookiesPs+a.getWorth(),CM.requiredChainTier("bank","this",CM.maxChainReward())),d=[0,0,0],e=[this.getLuckyTreshold(!1),this.getLuckyTreshold("frenzy"),c];return Game.cookies-b<e[0]&&(d[0]=e[0]-(Game.cookies-b)),Game.cookies-b<e[1]&&(d[1]=e[1]-(Game.cookies-b)),c!==!1&&Game.cookies-b<e[2]&&(d[2]=e[2]-(Game.cookies-b)),d},CME.computeColorCoding=function(a){var b,c=["yellow","yellow","yellow"],d=this.getBestValue("max"),e=this.getBestValue("min");for(b=0;b<a.length;b++)1/0===a[b]?c[b]="greyLight":a[b]<e[b]?c[b]="blue":a[b]===e[b]?c[b]="green":a[b]===d[b]?c[b]="red":a[b]>d[b]?c[b]="purple":d[b]-a[b]<a[b]-e[b]&&(c[b]="orange");return a[2]===e[2]&&(c[2]="cyan"),c},CMEO.isInStore=function(){return-1!==Game.UpgradesInStore.indexOf(this)},CME.simulateBuy=function(a,b){if("upgrade"===a.getType()&&a.bought>0)return 0;var c,d={SetResearch:Game.SetResearch,Popup:Game.Popup,Win:Game.Win,Unlock:Game.Unlock,Collect:Game.CollectWrinklers},e={cpsSucked:Game.cpsSucked,globalCpsMult:Game.globalCpsMult,cookiesPs:Game.cookiesPs,computedMouseCps:Game.computedMouseCps,pledges:Game.pledges};return Game.SetResearch=function(){},Game.Popup=function(){},Game.Win=function(){},Game.Unlock=function(){},Game.CollectWrinklers=function(){},a.simulateToggle(!0),Game.CalculateGains(),c=Game[b],a.simulateToggle(!1),Game.cpsSucked=e.cpsSucked,Game.globalCpsMult=e.globalCpsMult,Game.cookiesPs=e.cookiesPs,Game.computedMouseCps=e.computedMouseCps,Game.pledges=e.pledges,Game.SetResearch=d.SetResearch,Game.Popup=d.Popup,Game.Win=d.Win,Game.Unlock=d.Unlock,Game.CollectWrinklers=d.Collect,c-Game[b]},CMEO.simulateBuildingToggle=function(a){a?(this.amount++,this.bought++,this.buyFunction&&this.buyFunction()):(this.amount--,this.bought--,this.sellFunction&&this.sellFunction())},CMEO.simulateUpgradeToggle=function(a){a?(this.bought=1,this.buyFunction&&this.buyFunction(),3!==this.hide&&Game.UpgradesOwned++):(this.bought=0,3!==this.hide&&Game.UpgradesOwned--)},CMEO.isClickingRelated=function(){return this.matches("Clicking")||this.matches("The mouse")},CMEO.getClickingWorth=function(){return CME.callCached("getClickingUpgradeWorth",[this])},CME.getClickingUpgradeWorth=function(a){return this.simulateBuy(a,"computedMouseCps")},CME.controlTooltipPosition=function(){var a=Game.mouseY,b=CM.config.ccTooltip,c=CM.config.ccTooltipAnchor;this.tooltipLastObjectId&&(a=$(window).height()-b.outerHeight(),a-=40,a=-40>a?-40:a,a=Game.mouseY<a?Game.mouseY:a),c.offset({top:a,left:Game.mouseX})};